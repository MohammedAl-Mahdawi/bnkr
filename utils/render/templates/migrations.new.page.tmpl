{{template "base" .}}

{{define "content"}}
{{$res := index .Data "values"}}
{{$timezones := index .Data "timezones"}}
<form x-data="newMigration()" action="/migrations/{{with index .Data "id"}}{{.}}{{else}}new{{end}}" method="post" enctype="multipart/form-data">
    <input type="hidden" name="csrf_token" value="{{.CSRFToken}}">
    <div class="mb-3">
        <label for="exampleInputMigrationName1" class="form-label">Name</label>
        <input name="migrationName" class="form-control {{if .Form.Errors.Get "migrationName"}} is-invalid {{else if
            .Form.Has "migrationName" }} is-valid {{end}}" value="{{$res.Name}}" id="exampleInputMigrationName1"
            aria-describedby="migrationNameHelp">
        {{with .Form.Errors.Get "migrationName"}}
        <div class="invalid-feedback">
            {{.}}
        </div>
        {{end}}
    </div>
    <div class="mb-3">
        <label for="exampleInputTimezone1" class="form-label">Timezone</label>
        <select id="migration-timezone" name="timezone" class="form-select {{if .Form.Errors.Get "timezone"}} is-invalid {{else if
            .Form.Has "timezone" }} is-valid {{end}}" aria-label="Default select example">
            {{range $timezone := $timezones}}
            <option value="{{$timezone}}" {{with $res.Timezone}}{{if eq $res.Timezone $timezone }}selected{{end}}{{end}}>{{$timezone}}</option>
            {{end}}
        </select>
        {{with .Form.Errors.Get "timezone"}}
        <div class="invalid-feedback">
            {{.}}
        </div>
        {{end}}
    </div>
    <div class="mb-3">
        <label for="exampleInputNotificationEmail1" class="form-label">Notification Emails (Optional)</label>
        <input name="notificationEmail" placeholder="user1@example.com,user2@example.com" class="form-control {{if .Form.Errors.Get "notificationEmail"}} is-invalid
            {{else if .Form.Has "notificationEmail" }} is-valid {{end}}" value="{{$res.Emails}}"
            id="exampleInputNotificationEmail1" aria-describedby="notificationEmailHelp">
        {{with .Form.Errors.Get "notificationEmail"}}
        <div class="invalid-feedback">
            {{.}}
        </div>
        {{end}}
    </div>
    <div class="card">
        <div class="card-header">
          Source
        </div>
        <div class="card-body">
            <div class="mb-3">
                <label for="exampleInputSrcType1" class="form-label">SrcType</label>
                <select x-model="src_type" id="migration-src_type" name="src_type" class="form-select {{if .Form.Errors.Get "src_type"}} is-invalid {{else if
                    .Form.Has "src_type" }} is-valid {{end}}">
                    <option value="db" {{with $res.SrcType}}{{if eq $res.SrcType "db" }}selected{{end}}{{end}}>MySQL/MariaDB Database</option>
                    <option value="object" {{with $res.SrcType}}{{if eq $res.SrcType "object" }}selected{{end}}{{end}}>Files In Deployment or StatefulSet</option>
                    <option value="pod" {{with $res.SrcType}}{{if eq $res.SrcType "pod" }}selected{{end}}{{end}}>Files In Pod</option>
                    <option value="mongo" {{with $res.SrcType}}{{if eq $res.SrcType "mongo" }}selected{{end}}{{end}}>MongoDB</option>
                    <option value="pg" {{with $res.SrcType}}{{if eq $res.SrcType "pg" }}selected{{end}}{{end}}>PostgreSQL</option>
                    <option value="bnkr" {{with $res.SrcType}}{{if eq $res.SrcType "bnkr" }}selected{{end}}{{end}}>Bnkr DB</option>
                </select>
                {{with .Form.Errors.Get "src_type"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='mongo' || src_type=='pg'" class="mb-3">
                <label for="exampleInputSrcURI1" class="form-label">SrcURI</label>
                <input name="src_uri" class="form-control {{if .Form.Errors.Get "src_uri"}} is-invalid {{else if
                    .Form.Has "src_uri" }} is-valid {{end}}" value="{{with $res.SrcURI.Valid}}{{$res.SrcURI.String}}{{end}}" id="exampleInputSrcURI1"
                    aria-describedby="src_uriHelp">
                {{with .Form.Errors.Get "src_uri"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='ssh'" class="mb-3">
                <label for="exampleInputSrcSshHost1" class="form-label">SSH Host</label>
                <input name="src_ssh_host" class="form-control {{if .Form.Errors.Get "src_ssh_host"}} is-invalid {{else if
                    .Form.Has "src_ssh_host" }} is-valid {{end}}" value="{{$res.DbName}}" id="exampleInputSrcSshHost1"
                    aria-describedby="src_ssh_hostHelp">
                {{with .Form.Errors.Get "src_ssh_host"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='ssh'" class="mb-3">
                <label for="exampleInputSrcSshPort1" class="form-label">SSH Port</label>
                <input name="src_ssh_port" class="form-control {{if .Form.Errors.Get "src_ssh_port"}} is-invalid {{else if
                    .Form.Has "src_ssh_port" }} is-valid {{end}}" value="{{$res.DbName}}" id="exampleInputSrcSshPort1"
                    aria-describedby="src_ssh_portHelp">
                {{with .Form.Errors.Get "src_ssh_port"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='ssh'" class="mb-3">
                <label for="exampleInputSrcSshUser1" class="form-label">SSH User</label>
                <input name="src_ssh_user" class="form-control {{if .Form.Errors.Get "src_ssh_user"}} is-invalid {{else if
                    .Form.Has "src_ssh_user" }} is-valid {{end}}" value="{{$res.DbName}}" id="exampleInputSrcSshUser1"
                    aria-describedby="src_ssh_userHelp">
                {{with .Form.Errors.Get "src_ssh_user"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='ssh'" class="mb-3">
                <label for="exampleInputSrcSshKey1" class="form-label">SSH Key</label>
                <textarea name="src_ssh_key" class="form-control {{if .Form.Errors.Get "src_ssh_key"}} is-invalid {{else if
                    .Form.Has "src_ssh_key" }} is-valid {{end}}" id="exampleInputSrcSshKey1" aria-describedby="src_ssh_keyHelp" rows="3">{{$res.DbName}}</textarea>
                {{with .Form.Errors.Get "src_ssh_key"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='db'" class="mb-3">
                <label for="exampleInputSrcDbName1" class="form-label">Database Name</label>
                <input name="src_db_name" class="form-control {{if .Form.Errors.Get "src_db_name"}} is-invalid {{else if
                    .Form.Has "src_db_name" }} is-valid {{end}}" value="{{$res.DbName}}" id="exampleInputSrcDbName1"
                    aria-describedby="src_db_nameHelp">
                {{with .Form.Errors.Get "src_db_name"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_db_name=='db'" class="mb-3">
                <label for="exampleInputSrcDbUser1" class="form-label">Database User</label>
                <input name="src_db_user" class="form-control {{if .Form.Errors.Get "src_db_user"}} is-invalid {{else if
                    .Form.Has "src_db_user" }} is-valid {{end}}" value="{{$res.DbUser}}" id="exampleInputSrcDbUser1"
                    aria-describedby="src_db_userHelp">
                {{with .Form.Errors.Get "src_db_user"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='db'" class="mb-3">
                <label for="exampleInputSrcDbPassword1" class="form-label">Database Password</label>
                <input name="src_db_password" class="form-control {{if .Form.Errors.Get "src_db_password"}} is-invalid {{else if
                    .Form.Has "src_db_password" }} is-valid {{end}}" value="{{$res.DbPassword}}" id="exampleInputSrcDbPassword1"
                    aria-describedby="src_db_passwordHelp">
                {{with .Form.Errors.Get "src_db_password"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='db'" class="mb-3">
                <label for="exampleInputSrcDbHost1" class="form-label">Database Host</label>
                <input name="src_db_host" class="form-control {{if .Form.Errors.Get "src_db_host"}} is-invalid {{else if
                    .Form.Has "src_db_host" }} is-valid {{end}}" value="{{$res.DbHost}}" id="exampleInputSrcDbHost1"
                    aria-describedby="src_db_hostHelp">
                {{with .Form.Errors.Get "src_db_host"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div x-show="src_type=='db'" class="mb-3">
                <label for="exampleInputSrcDbPort1" class="form-label">Database Port</label>
                <input name="src_db_port" class="form-control {{if .Form.Errors.Get "src_db_port"}} is-invalid {{else if
                    .Form.Has "src_db_port" }} is-valid {{end}}" value="{{$res.DbPort}}" id="exampleInputSrcDbPort1"
                    aria-describedby="src_db_portHelp">
                {{with .Form.Errors.Get "src_db_port"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div class="mb-3" x-show="src_type=='object'">
                <label for="exampleInputSrcPodLabel1" class="form-label">Label To Find Pod</label>
                <input name="src_pod_label" class="form-control {{if .Form.Errors.Get "src_pod_label"}} is-invalid {{else if
                    .Form.Has "src_pod_label" }} is-valid {{end}}" value="{{$res.SrcPodLabel}}" id="exampleInputSrcPodLabel1"
                    aria-describedby="src_pod_labelHelp">
                {{with .Form.Errors.Get "src_pod_label"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
                <div id="src_pod_labelHelp" class="form-text">The label of the pod that we are going to migration the files inside its container, please use <code>=</code> with no space so <code>app: bnkr</code> become <code>app=bnkr</code>.
                </div>
            </div>
            <div class="mb-3" x-show="src_type=='pod'">
                <label for="exampleInputSrcPodName1" class="form-label">Pod Name</label>
                <input name="src_pod_name" class="form-control {{if .Form.Errors.Get "src_pod_name"}} is-invalid {{else if
                    .Form.Has "src_pod_name" }} is-valid {{end}}" value="{{$res.SrcPodName}}" id="exampleInputSrcPodName1"
                    aria-describedby="src_pod_nameHelp">
                {{with .Form.Errors.Get "src_pod_name"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
                <div id="src_pod_nameHelp" class="form-text">The pod that we are going to migration the files inside it.
                </div>
            </div>
            <div class="mb-3" x-show="src_type=='object' || src_type=='pod'">
                <label for="exampleInputSrcContainer1" class="form-label">SrcContainer</label>
                <input name="src_container" class="form-control {{if .Form.Errors.Get "src_container"}} is-invalid {{else if
                    .Form.Has "src_container" }} is-valid {{end}}" value="{{$res.SrcContainer}}" id="exampleInputSrcContainer1"
                    aria-describedby="src_containerHelp">
                {{with .Form.Errors.Get "src_container"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
                <div id="src_containerHelp" class="form-text">The src_container that we are going to migration the files inside it.
                </div>
            </div>
            <div class="mb-3" x-show="src_type=='object' || src_type=='pod'">
                <label for="exampleInputSrcFilesPath1" class="form-label">Files Path</label>
                <input name="src_files_path" class="form-control {{if .Form.Errors.Get "src_files_path"}} is-invalid {{else if
                    .Form.Has "src_files_path" }} is-valid {{end}}" value="{{$res.SrcFilesPath}}" id="exampleInputSrcFilesPath1"
                    aria-describedby="src_files_pathHelp">
                {{with .Form.Errors.Get "src_files_path"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
                <div id="src_files_pathHelp" class="form-text">The folder path inside the container.</div>
            </div>
            <div class="mb-3">
                <label for="exampleInputSrcS3AccessKey1" class="form-label">S3 Access Key</label>
                <input name="src_s3_access_key" class="form-control {{if .Form.Errors.Get "src_s3_access_key"}} is-invalid {{else if
                    .Form.Has "src_s3_access_key" }} is-valid {{end}}" value="{{$res.S3SrcS3AccessKey}}" id="exampleInputSrcS3AccessKey1"
                    aria-describedby="src_s3_access_keyHelp">
                {{with .Form.Errors.Get "src_s3_access_key"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div class="mb-3">
                <label for="exampleInputSrcS3SecretKey1" class="form-label">S3 Secret Key</label>
                <input name="src_s3_secret_key" class="form-control {{if .Form.Errors.Get "src_s3_secret_key"}} is-invalid {{else if
                    .Form.Has "src_s3_secret_key" }} is-valid {{end}}" value="{{$res.S3SrcS3SecretKey}}" id="exampleInputSrcS3SecretKey1"
                    aria-describedby="src_s3_secret_keyHelp">
                {{with .Form.Errors.Get "src_s3_secret_key"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div class="mb-3">
                <label for="exampleInputDestRegion1" class="form-label">DestRegion</label>
                <input name="dest_region" class="form-control {{if .Form.Errors.Get "dest_region"}} is-invalid {{else if
                    .Form.Has "dest_region" }} is-valid {{end}}" value="{{$res.DestRegion}}" id="exampleInputDestRegion1"
                    aria-describedby="dest_regionHelp">
                {{with .Form.Errors.Get "dest_region"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div class="mb-3">
                <label for="exampleInputSrcBucket1" class="form-label">SrcBucket</label>
                <input name="src_bucket" class="form-control {{if .Form.Errors.Get "src_bucket"}} is-invalid {{else if
                    .Form.Has "src_bucket" }} is-valid {{end}}" value="{{$res.SrcBucket}}" id="exampleInputSrcBucket1"
                    aria-describedby="src_bucketHelp">
                {{with .Form.Errors.Get "src_bucket"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
            <div class="mb-3">
                <label for="exampleInputSrcStorageDirectory1" class="form-label">Storage Directory (Optional)</label>
                <input placeholder="2021/weekly" name="src_storage_directory" class="form-control {{if .Form.Errors.Get "src_storage_directory"}} is-invalid {{else
                    if .Form.Has "src_storage_directory" }} is-valid {{end}}" value="{{$res.SrcStorageDirectory}}"
                    id="exampleInputSrcStorageDirectory1" aria-describedby="src_storage_directoryHelp">
                {{with .Form.Errors.Get "src_storage_directory"}}
                <div class="invalid-feedback">
                    {{.}}
                </div>
                {{end}}
            </div>
        </div>
    </div>
    <button type="submit" class="btn btn-primary">{{with index .Data "id"}}Update{{else}}Submit{{end}}</button>
</form>
{{end}}

{{define "js"}}
{{$res := index .Data "values"}}
<script>
    function newMigration(){
        return {
            customFrequency: '{{with $res.Frequency}}{{if eq . "custom" }}{{$res.CustomFrequency}}{{end}}{{end}}',
            textCron(){
                try {
                    return cronstrue.toString(this.customFrequency);
                } catch (error) {
                    return 'Standard Cron expression.';
                }
            },
            type: '{{with $res.Type}}{{.}}{{else}}db{{end}}',
            frequency:  '{{with $res.Frequency}}{{.}}{{else}}daily{{end}}'
        }
    }
</script>
{{end}}